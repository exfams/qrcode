<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Generator & Scanner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 { margin-bottom: 15px; }
    #qrcode, #reader {
      margin: 20px auto;
      padding: 15px;
      background: white;
      display: inline-block;
      border: 2px solid #ddd;
      border-radius: 8px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      width: 80%;
      max-width: 400px;
    }
    button {
      cursor: pointer;
      background: #007bff;
      border: none;
      color: white;
      border-radius: 5px;
      font-weight: bold;
    }
    button:hover { background: #0056b3; }
    #scanResult {
      margin-top: 15px;
      font-weight: bold;
      color: green;
    }
    #reader {
      display: none;
    }
  </style>
</head>
<body>

  <h1>QR Code Generator & Scanner</h1>

  <!-- Input dan Generate -->
  <input type="text" id="textInput" placeholder="Masukkan teks / link...">
  <br>
  <button onclick="generateQR()">Buat QR Code</button>
  <button onclick="downloadQR()">Download QR</button>
  <button onclick="startScan()">ðŸ“· Scan Kamera</button>
  <div id="qrcode"></div>

  <!-- Scanner -->
  <div id="reader" style="width:300px;"></div>
  <div id="scanResult">Hasil scan: -</div>

  <!-- Library QRCode -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- Library Scanner -->
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  
  <script>
    let qr;
    let scanner;

    function generateQR() {
      let input = document.getElementById("textInput").value.trim();
      if (!input) {
        alert("Masukkan teks atau link dulu!");
        return;
      }
      document.getElementById("qrcode").innerHTML = "";
      qr = new QRCode(document.getElementById("qrcode"), {
        text: input,
        width: 300,
        height: 300,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.M
      });
    }

    function downloadQR() {
  let canvas = document.querySelector("#qrcode canvas");
  if (!canvas) {
    alert("Generate QR dulu!");
    return;
  }

  // Skala 300 DPI (sekitar 3.125x dari 96dpi layar)
  let scale = 3.125;
  let exportCanvas = document.createElement("canvas");
  exportCanvas.width = canvas.width * scale;
  exportCanvas.height = canvas.height * scale;

  let ctx = exportCanvas.getContext("2d");
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, exportCanvas.width, exportCanvas.height);

  // Render ulang dengan kualitas HD
  ctx.drawImage(canvas, 0, 0, exportCanvas.width, exportCanvas.height);

  let link = document.createElement("a");
  link.href = exportCanvas.toDataURL("image/png", 1.0); // kualitas max
  link.download = "qrcode_hd.png";
  link.click();
}


    function startScan() {
      const reader = document.getElementById("reader");
      reader.style.display = "block";

      if (scanner) {
        scanner.stop().then(() => {
          runScanner();
        });
      } else {
        runScanner();
      }
    }

    function runScanner() {
      scanner = new Html5Qrcode("reader");
      scanner.start(
        { facingMode: "environment" }, // kamera belakang
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          document.getElementById("scanResult").innerText = "Hasil scan: " + decodedText;
          document.getElementById("textInput").value = decodedText;
          generateQR();  // langsung generate QR baru dari hasil scan
          stopScan();    // matikan kamera setelah berhasil scan
        },
        (errorMsg) => {
          // biarkan kosong supaya ga spam error di console
        }
      ).catch(err => {
        alert("Kamera tidak bisa diakses: " + err);
      });
    }

    function stopScan() {
      if (scanner) {
        scanner.stop().then(() => {
          document.getElementById("reader").style.display = "none";
        }).catch(err => console.error(err));
      }
    }
  </script>
</body>
</html>
